<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.project.SnakeDev.mapper.AuthMapper">
    <insert id="InsertJoin" parameterType="map">
        <choose>
            <when test='loginType == "kakao"'>
                update tbl_member set
                        MemberPw = #{MemberPw},
                        MemberPhone = #{MemberPhone}
                where MemberId = #{MemberId}
            </when>
            <otherwise>
                INSERT INTO Tbl_Member (MIdx, MemberName, MemberId, MemberPw, MemberPhone, MRegDate, LoginType)
                    VALUES (
                                #{MIdx, jdbcType=INTEGER},
                                #{MemberName, jdbcType=VARCHAR},
                                #{MemberId, jdbcType=VARCHAR},
                                #{MemberPw, jdbcType=VARCHAR},
                                #{MemberPhone, jdbcType=VARCHAR},
                                sysdate,
                                'local'
                            )
            </otherwise>
        </choose>
    </insert>

    <insert id="InsertMemberAddress" parameterType="map">
        <choose>
            <when test='loginType == "kakao"'>
                INSERT INTO Tbl_MemberAddress (MIdx, MZonecode, MAaddress, MDetailaddress, MAlatitude, MAlongitude)
                VALUES (
                            (select midx from tbl_member where memberId = #{MemberId}),
                            #{MZonecode},
                            #{MAaddress},
                            #{MDetailaddress},
                            #{MAlatitude},
                            #{MAlongitude}
                        )
            </when>
            <otherwise>
                INSERT INTO Tbl_MemberAddress (MIdx, MZonecode, MAaddress, MDetailaddress, MAlatitude, MAlongitude)
                VALUES (
                            #{MIdx},
                            #{MZonecode},
                            #{MAaddress},
                            #{MDetailaddress},
                            #{MAlatitude},
                            #{MAlongitude}
                        )
            </otherwise>
        </choose>
    </insert>

    <select id="IdCheck" resultType="java.lang.Boolean" parameterType="string">
<!--        select count(*) from tbl_member where MemberId = #{MmemberId}-->
        SELECT count(*)
            FROM tbl_member
            WHERE memberid = #{MemberId}
            AND NOT EXISTS (
            SELECT 1
            FROM tbl_member
            WHERE memberid = #{MemberId} AND logintype = 'kakao'
            )
    </select>

    <select id="login" resultType="String">
        select MemberName from tbl_member where MemberId = #{MemberId} and MemberPw = #{MemberPw}
    </select>

    <select id="existsByKakaoId" parameterType="String" resultType="int">
        select count(*) from tbl_member where Memberid = #{email}
    </select>

    <select id="findByKakaoId" parameterType="String" resultType="com.project.SnakeDev.vo.AuthVo">
        select * from tbl_member where memberid = #{email}
    </select>

    <insert id="insertKakaoUser" parameterType="com.project.SnakeDev.vo.kakaoVo">
        insert into tbl_member
            (MIdx,MemberName,MemberId,MemberPw, MemberPhone, MRegDate, LoginType)
        values
            (#{kakaoId, jdbcType=INTEGER},
             #{nickname, jdbcType=VARCHAR},
             #{email, jdbcType=VARCHAR},
             '',
             '',
             sysdate,
             'kakao')
    </insert>


    <!--    <insert id="InsertJoin" parameterType="com.project.SnakeDev.vo.AuthVo">-->
<!--        INSERT INTO tbl_member (MIdx, MemberName, MemberId, MemberPw, MemberPhone, MregDate)-->
<!--        VALUES (#{MIdx}, #{MemberName}, #{MemberId}, #{MemberPw}, #{MemberPhone}, sysdate)-->
<!--    </insert>-->

<!--    <insert id="InsertMemberAddress" parameterType="com.project.SnakeDev.vo.AuthVo">-->
<!--        INSERT INTO tbl_memberaddress (MIdx, MZonecode, MAaddress, MDetailaddress, MAlatitude, MAlongitude)-->
<!--        VALUES (#{MIdx}, #{MZonecode}, #{MAaddress}, #{MDetailaddress}, #{MAlatitude}, #{MAlongitude})-->
<!--    </insert>-->
</mapper>