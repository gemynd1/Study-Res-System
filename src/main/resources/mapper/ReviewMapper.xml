<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.project.SnakeDev.mapper.ReviewMapper">

    <insert id="InsertReview" parameterType="map">
        insert into tbl_studyreview (sridx, sgiIdx, mIdx, srcontent, srstar, srRegDate)
        values (
                SREVIEW_SEQ.nextval,
                #{sgiIdx},
                (select mIdx from tbl_member where memberid = #{memberId}),
                #{srContent},
                #{srStar},
                sysdate)
    </insert>


    <insert id="insertReviewImage" parameterType="String">
        <![CDATA[
        insert into tbl_studyreviewimg (sriImgIdx, srIdx, sriImg)
        values (
            ComCom_seq.nextval,
            (select * from (select sridx from tbl_studyreview order by sridx desc) where rownum <= 1),
            #{sriImg}
        )
        ]]>
    </insert>


    <insert id="InsertReviewTag" parameterType="String">
        insert into tbl_studyhastaglist (TSHTLIdx, TSHTLContent)
        values (
            SRMEMBERTAG_SEQ.nextval,
            #{TSHTLContent}
        )
    </insert>

    <insert id="InsertReviewHasTag">
    <![CDATA[
        insert into tbl_studyhastag (TSHTIdx, SRidx, TSHTLIdx)
        SELECT
            SHASTAG_SEQ.nextval,
            (SELECT sridx FROM (SELECT sridx FROM tbl_studyreview ORDER BY sridx DESC) WHERE rownum = 1),
            (SELECT TSHTLIdx FROM (SELECT TSHTLIdx FROM tbl_studyhastaglist ORDER BY TSHTLIdx DESC) WHERE rownum = 1)
        FROM dual
        ]]>
</insert>
<!--
    dual테이블 -> Oracle 더미 테이블 단일 행과 열 가짐. Oracle에 기본적으로
     존재, 목적 계산,상수 반환 ,서브 쿼리 실행 등 위해 select 문을 작성할 때
     빈 테이블로 활용
-->
</mapper>
